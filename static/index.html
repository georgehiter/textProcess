<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuringHIT_PDFTools</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📄</text></svg>">
    <script src="/static/js/vue.global.js"></script>
    <script src="/static/js/marked.min.js"></script>
    <script src="/static/js/config-manager.js"></script>
</head>

<body>
    <div id="app">
        <div class="container">
            <!-- 头部 -->
            <header class="header">
                <h1>TuringHIT_PDFTools</h1>
                <p>快速将PDF文档转换为Markdown格式，支持多种配置选项</p>
            </header>

            <!-- 单页面布局 -->

            <!-- 文件上传区域 -->
            <div class="section upload-section">
                <h3>📁 文件上传</h3>
                <div class="upload-area" :class="{ 'drag-over': isDragOver, 'has-file': uploadedFile }"
                    @drop="handleDrop" @dragover="handleDragOver" @dragleave="handleDragLeave">
                    <div v-if="!uploadedFile" class="upload-placeholder">
                        <div class="upload-icon">📁</div>
                        <h3>拖拽PDF文件到这里</h3>
                        <p>或者点击选择文件</p>
                        <input type="file" ref="fileInput" @change="handleFileSelect" accept=".pdf"
                            style="display: none;">
                        <button class="btn btn-primary" @click="$refs.fileInput.click()">
                            选择文件
                        </button>
                    </div>
                    <div v-else class="file-info">
                        <div class="file-icon">📄</div>
                        <div class="file-details">
                            <h4>{{ uploadedFile.name }}</h4>
                            <p>{{ formatFileSize(uploadedFile.size) }}</p>
                        </div>
                        <button class="btn btn-secondary" @click="removeFile">
                            移除
                        </button>
                    </div>
                </div>
            </div>

            <!-- 配置选项区域 -->
            <div class="section config-section">
                <h3>⚙️ 转换配置</h3>

                <!-- 配置预设选择 -->
                <div class="config-group" v-if="configManager && configManager.presets">
                    <h4>🎯 配置预设</h4>
                    <div class="preset-selector">
                        <div class="preset-tabs">
                            <div v-for="preset in configManager.presets" :key="preset.name" class="preset-tab"
                                :class="{ 'active': selectedPreset === preset.name }"
                                @click="selectPreset(preset.name)">
                                <div class="preset-icon">{{ getPresetIcon(preset.name) }}</div>
                                <div class="preset-content">
                                    <div class="preset-title">{{ preset.name }}</div>
                                    <div class="preset-description">{{ preset.description }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 转换方式选择 -->
                <div class="config-group">
                    <h4>🔄 转换方式选择</h4>
                    <div class="conversion-mode-selector">
                        <div class="mode-tab" :class="{ 'active': config.conversion_mode === 'marker' }"
                            @click="switchConversionMode('marker')">
                            <div class="tab-icon">📄</div>
                            <div class="tab-content">
                                <div class="tab-title">Marker转换</div>
                                <div class="tab-subtitle">文本版PDF专用</div>
                            </div>
                        </div>
                        <div class="mode-tab" :class="{ 'active': config.conversion_mode === 'ocr' }"
                            @click="switchConversionMode('ocr')">
                            <div class="tab-icon">🔍</div>
                            <div class="tab-content">
                                <div class="tab-title">OCR转换</div>
                                <div class="tab-subtitle">扫描版PDF专用</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 配置验证状态 -->
                <div v-if="configValidation" class="config-validation">
                    <div class="validation-status" :class="configValidation.valid ? 'valid' : 'invalid'">
                        <div class="status-icon">{{ configValidation.valid ? '✅' : '❌' }}</div>
                        <div class="status-content">
                            <div class="status-title">
                                {{ configValidation.valid ? '配置有效' : '配置存在问题' }}
                            </div>
                            <div class="status-summary">{{ configSummary }}</div>
                        </div>
                    </div>

                    <!-- 配置建议 -->
                    <div v-if="configValidation.suggestions && configValidation.suggestions.length > 0"
                        class="config-suggestions">
                        <h5>💡 配置建议</h5>
                        <ul>
                            <li v-for="suggestion in configValidation.suggestions" :key="suggestion">
                                {{ suggestion }}
                            </li>
                        </ul>
                    </div>

                    <!-- 配置警告 -->
                    <div v-if="configValidation.warnings && configValidation.warnings.length > 0"
                        class="config-warnings">
                        <h5>⚠️ 配置警告</h5>
                        <ul>
                            <li v-for="warning in configValidation.warnings" :key="warning">
                                {{ warning }}
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- 性能优化提示 -->
                <div class="optimization-tip">
                    <div class="tip-icon">🚀</div>
                    <div class="tip-content">
                        <h4>性能优化提示</h4>
                        <p>当前配置已针对速度进行优化，预计可提升25-40%的处理速度。如需更高准确性，可调整OCR设置。</p>
                    </div>
                </div>

                <!-- 输出格式固定为Markdown -->
                <div class="config-group">
                    <label>输出格式</label>
                    <div class="form-control" style="background-color: #f8fafc; color: #64748b; cursor: not-allowed;">
                        Markdown
                    </div>
                    <small>当前仅支持Markdown格式输出</small>
                </div>

                <!-- 高级配置选项 -->
                <div class="config-group">
                    <h4>🔧 高级配置</h4>
                    <div class="advanced-config">
                        <!-- Marker模式配置 -->
                        <div v-if="config.conversion_mode === 'marker'" class="marker-config">
                            <div class="config-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="config.gpu.enabled">
                                    <span class="checkmark"></span>
                                    启用GPU加速
                                </label>
                                <small>使用GPU加速可显著提升转换速度</small>
                            </div>

                            <div v-if="config.gpu.enabled" class="gpu-config">
                                <div class="config-row">
                                    <label>GPU设备数量</label>
                                    <input type="number" v-model="config.gpu.num_devices" min="1" max="8"
                                        class="form-control">
                                </div>
                                <div class="config-row">
                                    <label>工作进程数</label>
                                    <input type="number" v-model="config.gpu.num_workers" min="1" max="16"
                                        class="form-control">
                                </div>
                            </div>

                            <div class="config-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="config.use_llm">
                                    <span class="checkmark"></span>
                                    使用LLM增强准确性
                                </label>
                                <small>启用LLM可提升转换质量，但会增加处理时间</small>
                            </div>
                        </div>

                        <!-- OCR模式配置 -->
                        <div v-if="config.conversion_mode === 'ocr'" class="ocr-config">
                            <div class="config-row">
                                <label>OCR质量模式</label>
                                <select v-model="config.ocr_quality" class="form-control">
                                    <option value="fast">快速模式</option>
                                    <option value="balanced">平衡模式</option>
                                    <option value="accurate">高精度模式</option>
                                </select>
                            </div>

                            <div class="config-row">
                                <label>目标语言</label>
                                <div class="language-selector">
                                    <label class="checkbox-label">
                                        <input type="checkbox" v-model="config.target_languages" value="chi_sim">
                                        <span class="checkmark"></span>
                                        中文简体
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" v-model="config.target_languages" value="eng">
                                        <span class="checkmark"></span>
                                        英文
                                    </label>
                                </div>
                            </div>

                            <div class="config-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="config.enhance_quality">
                                    <span class="checkmark"></span>
                                    增强图像质量
                                </label>
                            </div>

                            <div class="config-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" v-model="config.language_detection">
                                    <span class="checkmark"></span>
                                    智能语言检测
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="action-buttons">
                    <button class="btn btn-primary" @click="startConversion" :disabled="!uploadedFile || isConverting">
                        {{ isConverting ? '转换中...' : '开始转换' }}
                    </button>
                    <button class="btn btn-secondary" @click="validateCurrentConfig">
                        验证配置
                    </button>
                    <button class="btn btn-outline" @click="resetConfig">
                        重置配置
                    </button>
                </div>
            </div>

            <!-- 转换进度区域 -->
            <div v-if="isConverting" class="section progress-section">
                <h3>🔄 转换进度</h3>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" :style="{ width: progress + '%' }"></div>
                    </div>
                    <div class="progress-info">
                        <span class="progress-text">{{ progress.toFixed(1) }}%</span>
                        <span class="progress-time">{{ elapsedTime }}</span>
                    </div>
                </div>
            </div>

            <!-- 错误提示 -->
            <div v-if="error" class="section error-section">
                <div class="error-message">
                    <div class="error-icon">❌</div>
                    <div class="error-content">
                        <h4>转换失败</h4>
                        <p>{{ error }}</p>
                    </div>
                </div>
            </div>

            <!-- 结果展示区域 -->
            <div v-if="showResult" class="section result-section">
                <h3>📄 转换结果</h3>
                <div class="result-container">
                    <div class="result-header">
                        <div class="result-info">
                            <h4>转换完成</h4>
                            <p>处理时间: {{ processingTime }}秒</p>
                            <p v-if="hasImages">包含 {{ imageCount }} 张图片</p>
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-primary" @click="downloadResult">
                                下载Markdown
                            </button>
                            <button v-if="hasImages" class="btn btn-secondary" @click="downloadImages">
                                下载图片包
                            </button>
                            <button class="btn btn-outline" @click="startNewConversion">
                                重新转换
                            </button>
                        </div>
                    </div>

                    <div class="result-preview">
                        <h5>预览</h5>
                        <div class="preview-container" v-html="renderedPreview"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>